"use strict";(()=>{var e={};e.id=9739,e.ids=[9739],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},33420:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>b,requestAsyncStorage:()=>d,routeModule:()=>y,serverHooks:()=>w,staticGenerationAsyncStorage:()=>m});var o={};r.r(o),r.d(o,{GET:()=>h,dynamic:()=>f});var n=r(79182),a=r(72007),s=r(56719),i=r(93442),l=r(57978),c=r(11826),u=r(83178),p=r(63562);let f="force-dynamic";async function h(e,{params:t}){try{let e=await (0,l.getServerSession)(c.L);if(!e?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=t.symbol.toUpperCase(),o=await u._.stockData.findUnique({where:{symbol:r}});if(!o)return i.NextResponse.json({error:"Stock not found"},{status:404});let n=null;try{n=await p.J.getQuote(r)}catch(e){console.error(`Failed to fetch real-time quote for ${r}:`,e),n={c:o.currentPrice,pc:o.previousClose,o:null,h:null,l:null}}let a=await u._.watchlistItem.findFirst({where:{ticker:r}}),s=[];try{s=await p.J.getCompanyNews(r,new Date(Date.now()-6048e5).toISOString().split("T")[0],new Date().toISOString().split("T")[0])||[]}catch(e){s=[]}let f={...o?JSON.parse(JSON.stringify(o,(e,t)=>"bigint"==typeof t?t.toString():t)):null,realTimeQuote:n,isInWatchlist:!!a,news:s.slice(0,10)};return i.NextResponse.json(f)}catch(e){return console.error("Error fetching stock details:",e),i.NextResponse.json({error:"Failed to fetch stock details"},{status:500})}}let y=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/market/[symbol]/route",pathname:"/api/market/[symbol]",filename:"route",bundlePath:"app/api/market/[symbol]/route"},resolvedPagePath:"/home/ubuntu/oshaughnessy_trader/nextjs_space/app/api/market/[symbol]/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:w}=y,g="/api/market/[symbol]/route";function b(){return(0,s.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:m})}},11826:(e,t,r)=>{r.d(t,{L:()=>c});var o=r(64617),n=r(66291),a=r(88120),s=r(3390),i=r.n(s),l=r(83178);let c={adapter:(0,o.N)(l._),providers:[(0,a.Z)({clientId:process.env.GOOGLE_CLIENT_ID||"",clientSecret:process.env.GOOGLE_CLIENT_SECRET||"",authorization:{params:{prompt:"consent",access_type:"offline",response_type:"code"}}}),(0,n.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await l._.user.findUnique({where:{email:e.email}});return t?.password&&await i().compare(e.password,t.password)?{id:t.id,email:t.email,name:t.name}:null}})],session:{strategy:"jwt"},pages:{signIn:"/auth/signin"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e),session:async({session:e,token:t})=>(t&&e.user&&(e.user.id=t.id),e)}}},83178:(e,t,r)=>{r.d(t,{_:()=>n});var o=r(53524);let n=globalThis.prisma??new o.PrismaClient},63562:(e,t,r)=>{r.d(t,{J:()=>n});class o{get apiKey(){return process.env.FINNHUB_API_KEY||""}async getQuote(e){try{let t=await fetch(`${this.baseUrl}/quote?symbol=${e}&token=${this.apiKey}`);if(!t.ok)throw Error("Failed to fetch quote");return await t.json()}catch(t){return console.error(`Error fetching quote for ${e}:`,t),null}}async getCompanyProfile(e){try{let t=await fetch(`${this.baseUrl}/stock/profile2?symbol=${e}&token=${this.apiKey}`);if(!t.ok)throw Error("Failed to fetch company profile");return await t.json()}catch(t){return console.error(`Error fetching profile for ${e}:`,t),null}}async getCompanyFinancials(e,t="all"){try{let r=await fetch(`${this.baseUrl}/stock/metric?symbol=${e}&metric=${t}&token=${this.apiKey}`);if(!r.ok)throw Error("Failed to fetch financials");return await r.json()}catch(t){return console.error(`Error fetching financials for ${e}:`,t),null}}async getCompanyNews(e,t,r){try{let o=await fetch(`${this.baseUrl}/company-news?symbol=${e}&from=${t}&to=${r}&token=${this.apiKey}`);if(!o.ok)throw Error("Failed to fetch news");return await o.json()}catch(t){return console.error(`Error fetching news for ${e}:`,t),[]}}async getNewsSentiment(e){try{let t=await fetch(`${this.baseUrl}/news-sentiment?symbol=${e}&token=${this.apiKey}`);if(!t.ok)throw Error("Failed to fetch news sentiment");return await t.json()}catch(t){return console.error(`Error fetching news sentiment for ${e}:`,t),null}}async getEarningsCalendar(e,t){try{let r=`${this.baseUrl}/calendar/earnings?from=${e}&to=${t}&token=${this.apiKey}`,o=await fetch(r);if(!o.ok)throw Error(`Failed to fetch earnings calendar: ${o.status}`);return await o.json()}catch(e){return console.error("Error fetching earnings calendar:",e),{earningsCalendar:[]}}}async getStockSymbols(e="US"){try{let t=`${this.baseUrl}/stock/symbol?exchange=${e}&token=${this.apiKey}`,r=await fetch(t);if(!r.ok){let e=await r.text();throw console.error(`Finnhub API error (${r.status}):`,e),Error(`Failed to fetch stock symbols: ${r.status}`)}return await r.json()}catch(e){return console.error("Error fetching stock symbols:",e),[]}}async getHistoricalPrices(e,t,r,o){try{let n=await fetch(`${this.baseUrl}/stock/candle?symbol=${e}&resolution=${t}&from=${r}&to=${o}&token=${this.apiKey}`);if(!n.ok)throw Error("Failed to fetch historical prices");let a=await n.json();if("no_data"===a.s)return null;return a}catch(t){return console.error(`Error fetching historical prices for ${e}:`,t),null}}async getCompanyEarnings(e,t=4){try{let r=await fetch(`${this.baseUrl}/stock/earnings?symbol=${e}&limit=${t}&token=${this.apiKey}`);if(!r.ok)throw Error("Failed to fetch company earnings");return await r.json()}catch(t){return console.error(`Error fetching earnings for ${e}:`,t),null}}constructor(){this.baseUrl="https://finnhub.io/api/v1"}}let n=new o},23926:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},57978:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var o={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a.default}});var n=r(23926);Object.keys(n).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(o,e))&&(e in t&&t[e]===n[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}}))});var a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(void 0);if(r&&r.has(e))return r.get(e);var o={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&({}).hasOwnProperty.call(e,a)){var i=n?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(o,a,i):o[a]=e[a]}return o.default=e,r&&r.set(e,o),o}(r(15649));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}Object.keys(a).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(o,e))&&(e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[4372,7329,4178,7609],()=>r(33420));module.exports=o})();